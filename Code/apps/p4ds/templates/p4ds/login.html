{% extends "p4ds/base_layout.html" %}
{% load static %}
{% block body %}
<section class="login-page">
    <div class="login-container">
        <h2>Log In</h2>
        <form id="loginForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="user_id">User ID</label>
                <input type="text" class="form-control" id="user_id" name="user_id" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="button" class="btn btn-primary mt-3" onclick="submitLoginForm()">Log In</button>
        </form>
    </div>
</section>

<script>
    function getValueOrNull(id) {
        var element = document.getElementById(id);
        return element && element.value.trim() !== '' ? element.value : null;
    }

    function submitLoginForm() {
        var jsonData = {
            "user_id": getValueOrNull('user_id'),
            "password": getValueOrNull('password')
        };

        fetch(`/api/user/login/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: JSON.stringify(jsonData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Redirect to the home page after successful login
                window.location.href = '/';
            } else {
                console.error('Login failed:', data.message);
                alert("Login failed: " + (data.message || "Please try again."));
            }
        })
        .catch(error => {
            console.log('Error during login:', error);
            alert("An unexpected error occurred. Please try again later.");
        });
    }
</script>
{% endblock %}